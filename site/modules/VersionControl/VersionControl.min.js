$(function(){var a={empty:!0,render:"HTML"},b=config.VersionControl,c={};$.get(b.processPage+"page",{pages_id:b.pageID,settings:a},function(a){$("body").prepend(a),$("#text-field-history > div").each(function(){if($(this).data("revision")){var a=$(".Inputfield_"+$(this).data("field"));if(a.find("> label").addClass("with-history").before($(this)),$(this).find("a:first").addClass("ui-state-active"),a.hasClass("InputfieldTinyMCE")||a.hasClass("InputfieldCKEditor"))return;c[$(this).data("field")+"."+$(this).data("revision")]=a.find("div.ui-widget-content, .InputfieldContent").clone(!0,!0)}}),$(".ui-widget-header.with-history, .InputfieldHeader.with-history").each(function(){var a="field-revisions-toggle",b="";$(this).siblings(".field-revisions").find("li").length<1&&(a+=" inactive",b=" title='"+$(this).siblings(".field-revisions").text()+"'");var c="<a "+b+'class="'+a+'"><i class="fa fa-clock-o"></i></a>';$(this).find(".toggle-icon").length?$(this).find(".toggle-icon").after(c):$(this).append(c)}),$(".field-revisions").on("click","> ul > li > a",function(){if($(this).hasClass("ui-state-active"))return!1;var a={render:"Input"},e=$(this),f=e.parents(".Inputfield:first"),g=e.parents(".field-revisions:first").data("field");f.find(".field-revisions .ui-state-active").removeClass("ui-state-active"),e.addClass("ui-state-active"),$(".compare-revisions").remove();var h=f.find("div.ui-widget-content, .InputfieldContent"),i=$('<span class="field-revisions-loading"></span>').hide().css({height:h.innerHeight()+"px",backgroundColor:h.css("background-color")});(f.hasClass("InputfieldTinyMCE")||f.hasClass("InputfieldCKEditor"))&&(a={render:"JSON"});var j=$(this).data("revision");if(c[g+"."+j])if("JSON"!=a.render&&j==e.parents(".field-revisions:first").data("revision")){if(h.replaceWith(c[g+"."+j].clone(!0,!0)),f.find(".InputfieldFileList").length&&$.getScript(config.urls.modules+"Inputfield/InputfieldFile/InputfieldFile.js"),f.hasClass("InputfieldImage")&&(f.find(".InputfieldImageListToggle").remove(),$.getScript(config.urls.modules+"Inputfield/InputfieldImage/InputfieldImage.js")),f.find(".InputfieldAsmSelect").length){var k=f.find("select[multiple=multiple]"),l="undefined"==typeof config?{sortable:!0}:config[k.attr("id")];k.appendTo(f.find(".InputfieldAsmSelect")).show(),f.find(".asmContainer").remove(),k.asmSelect(l)}}else d(f,h,a,g,c[g+"."+j]);else h.css("position","relative").prepend(i.fadeIn(250)),$.get(b.processPage+"field",{revision:e.data("revision"),field:g,settings:a},function(b){c[g+"."+j]=b,d(f,h,a,g,c[g+"."+j]),i.fadeOut(350,function(){$(this).remove()})});return!1});var d=function(a,c,d,e,f){if("Input"==d.render){var g=c.children("p.description:first"),h=c.children("p.notes:first");if(c.html(f).prepend(g).append(h),a.hasClass("InputfieldImage")||a.hasClass("InputfieldFile")?(a.removeClass("InputfieldImageGrid"),c.prepend('<div class="version-control-overlay"></div>'),$(".version-control-overlay").attr("title",b.i18n.editDisabled).on("click",function(){alert($(this).attr("title"))}).hover(function(){$(this).parent(".overlay-parent").addClass("hover")},function(){$(this).parent(".overlay-parent").removeClass("hover")}).parent(".InputfieldContent").addClass("overlay-parent")):a.hasClass("Inputfield_permissions")&&($(".Inputfield_permissions .Inputfield_permissions > .InputfieldContent").insertAfter($(".Inputfield_permissions:first > .InputfieldContent:first")),$(".Inputfield_permissions:first > .InputfieldContent:first").remove()),a.find(".InputfieldAsmSelect").length){var i=a.find("select[multiple=multiple]"),j="undefined"==typeof config?{sortable:!0}:config[i.attr("id")];i.asmSelect(j)}}else $.each(f,function(b,c){var d=b.replace("data","");d&&(d="__"+d),"undefined"!=typeof tinyMCE&&tinyMCE.get("Inputfield_"+e+d)?tinyMCE.get("Inputfield_"+e+d).setContent(c):a.find(".InputfieldCKEditorInline").length?a.find(".InputfieldCKEditorInline").html(c):"undefined"!=typeof CKEDITOR&&CKEDITOR.instances["Inputfield_"+e+d]&&CKEDITOR.instances["Inputfield_"+e+d].setData(c)})};$(".field-revisions-toggle").on("click mouseenter",function(){if($(this).hasClass("inactive"))return!1;var a=$(this).parent("label").siblings(".field-revisions"),b=!a.is(":visible");return $(".field-revisions").slideUp(),b&&a.slideDown(),!1});var e;$(".field-revisions").on("mouseenter",function(){$(this).slideDown(),e&&(clearTimeout(e),e=!1)}).on("mouseleave",function(){var a=$(this);e=setTimeout(function(){e=!1,a.slideUp(function(){$(".compare-revisions").remove()})},500)}),$(".field-revisions > ul").each(function(){var a=$(this)[0];$(this).parent().show(),a.clientHeight<a.scrollHeight&&$(this).addClass("scroll"),$(this).parent().hide()});var f=function(){var a=new diff_match_patch,c=document.getElementById("r1").value,d=document.getElementById("r2").value;a.Diff_Timeout=b.diff.timeout,a.Diff_EditCost=b.diff.editCost;var f=((new Date).getTime(),a.diff_main(c,d));(new Date).getTime();b.diff.cleanup&&a["diff_cleanup"+b.diff.cleanup](f);var i=a.diff_prettyHtml(f);document.getElementById("diff").innerHTML=i};$(".field-revisions.diff").on("hover","> ul > li > a",function(){if($(".compare-revisions").remove(),!$(this).hasClass("ui-state-active")){var a=$(this).parents(".field-revisions:first").data("field"),c=$(this).parents(".field-revisions:first").find(".ui-state-active").data("revision"),d=$(this).data("revision"),e=b.processPage+"diff/?revisions="+c+":"+d+"&field="+a,f=b.i18n.compareWithCurrent;$(this).before('<div class="compare-revisions"><a class="diff-trigger" href="'+e+'">'+f+"</a></div>")}}).on("click",".compare-revisions > a.diff-trigger",function(){var a=$(this).parent(),c=$('<span class="field-revisions-loading"></span>').hide().css({height:a.innerHeight()+"px",backgroundColor:a.css("background-color")});return a.prepend(c.fadeIn(250)).load($(this).attr("href"),function(){$(this).find("a.diff-trigger").remove(),a.find("ul.page-diff").length?"function"!=typeof enableDiffSwitch?$.getScript(b.moduleDir+"diff_switch.min.js",function(){enableDiffSwitch(b)}):enableDiffSwitch(b):"function"!=typeof diff_match_patch?$.getScript(b.moduleDir+"diff_match_patch_20121119/javascript/diff_match_patch.js",function(){f()}):f(),$(this).animate({width:"400px",padding:"14px"}),c.fadeOut(350,function(){$(this).remove()})}),!1})})});
